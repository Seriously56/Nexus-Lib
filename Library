--[[
    Milenium Library - Fixed Mobile/PC Support
    -> Made by @finobe 
    -> Fixed for cross-platform compatibility
]]

-- Variables 
    local uis = game:GetService("UserInputService") 
    local players = game:GetService("Players") 
    local ws = game:GetService("Workspace")
    local rs = game:GetService("ReplicatedStorage")
    local http_service = game:GetService("HttpService")
    local gui_service = game:GetService("GuiService")
    local lighting = game:GetService("Lighting")
    local run = game:GetService("RunService")
    local stats = game:GetService("Stats")
    local coregui = game:GetService("CoreGui")
    local debris = game:GetService("Debris")
    local tween_service = game:GetService("TweenService")
    local sound_service = game:GetService("SoundService")

    local vec2 = Vector2.new
    local vec3 = Vector3.new
    local dim2 = UDim2.new
    local dim = UDim.new 
    local rect = Rect.new
    local cfr = CFrame.new
    local empty_cfr = cfr()
    local point_object_space = empty_cfr.PointToObjectSpace
    local angle = CFrame.Angles
    local dim_offset = UDim2.fromOffset

    local color = Color3.new
    local rgb = Color3.fromRGB
    local hex = Color3.fromHex
    local hsv = Color3.fromHSV
    local rgbseq = ColorSequence.new
    local rgbkey = ColorSequenceKeypoint.new
    local numseq = NumberSequence.new
    local numkey = NumberSequenceKeypoint.new

    local camera = ws.CurrentCamera
    local lp = players.LocalPlayer 
    local mouse = lp:GetMouse() 
    local gui_offset = gui_service:GetGuiInset().Y

    local max = math.max 
    local floor = math.floor 
    local min = math.min 
    local abs = math.abs 
    local noise = math.noise
    local rad = math.rad 
    local random = math.random 
    local pow = math.pow 
    local sin = math.sin 
    local pi = math.pi 
    local tan = math.tan 
    local atan2 = math.atan2 
    local clamp = math.clamp 

    local insert = table.insert 
    local find = table.find 
    local remove = table.remove
    local concat = table.concat
-- 

-- Library init
    getgenv().library = {
        directory = "milenium",
        folders = {
            "/fonts",
            "/configs",
        },
        flags = {},
        config_flags = {},
        connections = {},   
        notifications = {notifs = {}},
        current_open; 
    }

    -- Device detection
    local isMobile = uis.TouchEnabled and (not uis.KeyboardEnabled or uis.Platform == Enum.Platform.IOS or uis.Platform == Enum.Platform.Android)
    local isPC = not isMobile
    local scale = isMobile and 0.7 or 1

    local themes = {
        preset = {
            accent = rgb(155, 150, 219),
        }, 

        utility = {
            accent = {
                BackgroundColor3 = {}, 	
                TextColor3 = {}, 
                ImageColor3 = {}, 
                ScrollBarImageColor3 = {} 
            },
        }
    }

    local keys = {
        [Enum.KeyCode.LeftShift] = "LS",
        [Enum.KeyCode.RightShift] = "RS",
        [Enum.KeyCode.LeftControl] = "LC",
        [Enum.KeyCode.RightControl] = "RC",
        [Enum.KeyCode.Insert] = "INS",
        [Enum.KeyCode.Backspace] = "BS",
        [Enum.KeyCode.Return] = "Ent",
        [Enum.KeyCode.LeftAlt] = "LA",
        [Enum.KeyCode.RightAlt] = "RA",
        [Enum.KeyCode.CapsLock] = "CAPS",
        [Enum.KeyCode.One] = "1",
        [Enum.KeyCode.Two] = "2",
        [Enum.KeyCode.Three] = "3",
        [Enum.KeyCode.Four] = "4",
        [Enum.KeyCode.Five] = "5",
        [Enum.KeyCode.Six] = "6",
        [Enum.KeyCode.Seven] = "7",
        [Enum.KeyCode.Eight] = "8",
        [Enum.KeyCode.Nine] = "9",
        [Enum.KeyCode.Zero] = "0",
        [Enum.KeyCode.KeypadOne] = "Num1",
        [Enum.KeyCode.KeypadTwo] = "Num2",
        [Enum.KeyCode.KeypadThree] = "Num3",
        [Enum.KeyCode.KeypadFour] = "Num4",
        [Enum.KeyCode.KeypadFive] = "Num5",
        [Enum.KeyCode.KeypadSix] = "Num6",
        [Enum.KeyCode.KeypadSeven] = "Num7",
        [Enum.KeyCode.KeypadEight] = "Num8",
        [Enum.KeyCode.KeypadNine] = "Num9",
        [Enum.KeyCode.KeypadZero] = "Num0",
        [Enum.KeyCode.Minus] = "-",
        [Enum.KeyCode.Equals] = "=",
        [Enum.KeyCode.Tilde] = "~",
        [Enum.KeyCode.LeftBracket] = "[",
        [Enum.KeyCode.RightBracket] = "]",
        [Enum.KeyCode.RightParenthesis] = ")",
        [Enum.KeyCode.LeftParenthesis] = "(",
        [Enum.KeyCode.Semicolon] = ",",
        [Enum.KeyCode.Quote] = "'",
        [Enum.KeyCode.BackSlash] = "\\",
        [Enum.KeyCode.Comma] = ",",
        [Enum.KeyCode.Period] = ".",
        [Enum.KeyCode.Slash] = "/",
        [Enum.KeyCode.Asterisk] = "*",
        [Enum.KeyCode.Plus] = "+",
        [Enum.KeyCode.Period] = ".",
        [Enum.KeyCode.Backquote] = "`",
        [Enum.UserInputType.MouseButton1] = "MB1",
        [Enum.UserInputType.MouseButton2] = "MB2",
        [Enum.UserInputType.MouseButton3] = "MB3",
        [Enum.KeyCode.Escape] = "ESC",
        [Enum.KeyCode.Space] = "SPC",
    }
        
    library.__index = library

    for _, path in next, library.folders do 
        makefolder(library.directory .. path)
    end

    local flags = library.flags 
    local config_flags = library.config_flags
    local notifications = library.notifications 

    local fonts = {}; do
        function Register_Font(Name, Weight, Style, Asset)
            if not isfile(Asset.Id) then
                writefile(Asset.Id, Asset.Font)
            end

            if isfile(Name .. ".font") then
                delfile(Name .. ".font")
            end

            local Data = {
                name = Name,
                faces = {
                    {
                        name = "Normal",
                        weight = Weight,
                        style = Style,
                        assetId = getcustomasset(Asset.Id),
                    },
                },
            }

            writefile(Name .. ".font", http_service:JSONEncode(Data))

            return getcustomasset(Name .. ".font");
        end
        
        local Medium = Register_Font("Medium", 200, "Normal", {
            Id = "Medium.ttf",
            Font = game:HttpGet("https://raw.githubusercontent.com/your-repo/fonts/main/Inter-Medium.ttf"),
        })

        local SemiBold = Register_Font("SemiBold", 200, "Normal", {
            Id = "SemiBold.ttf",
            Font = game:HttpGet("https://raw.githubusercontent.com/your-repo/fonts/main/Inter-SemiBold.ttf"),
        })

        fonts = {
            small = Font.new(Medium, Enum.FontWeight.Regular, Enum.FontStyle.Normal);
            font = Font.new(SemiBold, Enum.FontWeight.Regular, Enum.FontStyle.Normal);
        }
    end
--

-- Library functions 
    -- Misc functions
        function library:tween(obj, properties, easing_style, time) 
            local tween = tween_service:Create(obj, TweenInfo.new(time or 0.25, easing_style or Enum.EasingStyle.Quint, Enum.EasingDirection.InOut, 0, false, 0), properties):Play()
            return tween
        end

        function library:isValidInput(input, checkTouch, checkMouse)
            if isMobile then
                return checkTouch and input.UserInputType == Enum.UserInputType.Touch
            else
                return checkMouse and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.MouseButton2)
            end
        end

        function library:connectInput(element, callback, checkTouch, checkMouse)
            return element.InputBegan:Connect(function(input)
                if self:isValidInput(input, checkTouch, checkMouse) then
                    callback(input)
                end
            end)
        end

        function library:resizify(frame) 
            local Frame = Instance.new("TextButton")
            Frame.Position = dim2(1, -10, 1, -10)
            Frame.BorderColor3 = rgb(0, 0, 0)
            Frame.Size = UDim2.new(0.8, 0, 0.3, 0)
            Frame.BorderSizePixel = 0
            Frame.BackgroundColor3 = rgb(255, 255, 255)
            Frame.Parent = frame
            Frame.BackgroundTransparency = 1 
            Frame.Text = ""

            local resizing = false 
            local start_size 
            local start 
            local og_size = frame.Size  

            library:connectInput(Frame, function(input)
                resizing = true
                start = input.Position
                start_size = frame.Size
            end, true, true)

            library:connection(uis.InputEnded, function(input)
                if library:isValidInput(input, true, true) then
                    resizing = false
                end
            end)

            library:connection(uis.InputChanged, function(input) 
                if resizing and ((isMobile and input.UserInputType == Enum.UserInputType.Touch) or (isPC and input.UserInputType == Enum.UserInputType.MouseMovement)) then
                    local viewport_x = camera.ViewportSize.X
                    local viewport_y = camera.ViewportSize.Y

                    local current_size = dim2(
                        start_size.X.Scale,
                        math.clamp(
                            start_size.X.Offset + (input.Position.X - start.X),
                            og_size.X.Offset,
                            viewport_x
                        ),
                        start_size.Y.Scale,
                        math.clamp(
                            start_size.Y.Offset + (input.Position.Y - start.Y),
                            og_size.Y.Offset,
                            viewport_y
                        )
                    )

                    library:tween(frame, {Size = current_size}, Enum.EasingStyle.Linear, 0.05)
                end
            end)
        end 

        function fag(tbl)
            local Size = 0
            for _ in tbl do
                Size = Size + 1
            end
            return Size
        end
        
        function library:next_flag()
            local index = fag(library.flags) + 1;
            local str = string.format("flagnumber%s", index)
            return str;
        end 

        function library:mouse_in_frame(uiobject)
            if isMobile then
                local touchPositions = uis:GetTouchPoints()
                if #touchPositions == 0 then return false end
                local touchPos = touchPositions[1].Position
                
                local y_cond = uiobject.AbsolutePosition.Y <= touchPos.Y and touchPos.Y <= uiobject.AbsolutePosition.Y + uiobject.AbsoluteSize.Y
                local x_cond = uiobject.AbsolutePosition.X <= touchPos.X and touchPos.X <= uiobject.AbsolutePosition.X + uiobject.AbsoluteSize.X
                return (y_cond and x_cond)
            else
                local y_cond = uiobject.AbsolutePosition.Y <= mouse.Y and mouse.Y <= uiobject.AbsolutePosition.Y + uiobject.AbsoluteSize.Y
                local x_cond = uiobject.AbsolutePosition.X <= mouse.X and mouse.X <= uiobject.AbsolutePosition.X + uiobject.AbsoluteSize.X
                return (y_cond and x_cond)
            end
        end

        function library:draggify(frame)
            local dragging = false 
            local start_size = frame.Position
            local start 

            library:connectInput(frame, function(input)
                dragging = true
                start = input.Position
                start_size = frame.Position
            end, true, true)

            library:connection(uis.InputEnded, function(input)
                if library:isValidInput(input, true, true) then
                    dragging = false
                end
            end)

            library:connection(uis.InputChanged, function(input) 
                if dragging and ((isMobile and input.UserInputType == Enum.UserInputType.Touch) or (isPC and input.UserInputType == Enum.UserInputType.MouseMovement)) then
                    local viewport_x = camera.ViewportSize.X
                    local viewport_y = camera.ViewportSize.Y

                    local current_position = dim2(
                        0,
                        clamp(
                            start_size.X.Offset + (input.Position.X - start.X),
                            0,
                            viewport_x - frame.Size.X.Offset
                        ),
                        0,
                        math.clamp(
                            start_size.Y.Offset + (input.Position.Y - start.Y),
                            0,
                            viewport_y - frame.Size.Y.Offset
                        )
                    )

                    library:tween(frame, {Position = current_position}, Enum.EasingStyle.Linear, 0.05)
                    library:close_element()
                end
            end)
        end 

        function library:convert(str)
            local values = {}
            for value in string.gmatch(str, "[^,]+") do
                insert(values, tonumber(value))
            end
            if #values == 4 then              
                return unpack(values)
            else 
                return
            end
        end
        
        function library:convert_enum(enum)
            local enum_parts = {}
            for part in string.gmatch(enum, "[%w_]+") do
                insert(enum_parts, part)
            end
            local enum_table = Enum
            for i = 2, #enum_parts do
                local enum_item = enum_table[enum_parts[i]]
                enum_table = enum_item
            end
            return enum_table
        end

        local config_holder;
        function library:update_config_list() 
            if not config_holder then 
                return 
            end
            local list = {}
            for idx, file in listfiles(library.directory .. "/configs") do
                local name = file:gsub(library.directory .. "/configs\\", ""):gsub(".cfg", ""):gsub(library.directory .. "\\configs\\", "")
                list[#list + 1] = name
            end
            config_holder.refresh_options(list)
        end 

        function library:get_config()
            local Config = {}
            for _, v in next, flags do
                if type(v) == "table" and v.key then
                    Config[_] = {active = v.active, mode = v.mode, key = tostring(v.key)}
                elseif type(v) == "table" and v["Transparency"] and v["Color"] then
                    Config[_] = {Transparency = v["Transparency"], Color = v["Color"]:ToHex()}
                else
                    Config[_] = v
                end
            end 
            return http_service:JSONEncode(Config)
        end

        function library:load_config(config_json) 
            local config = http_service:JSONDecode(config_json)
            for _, v in config do 
                local function_set = library.config_flags[_]
                if _ == "config_name_list" then 
                    continue 
                end
                if function_set then 
                    if type(v) == "table" and v["Transparency"] and v["Color"] then
                        function_set(hex(v["Color"]), v["Transparency"])
                    elseif type(v) == "table" and v["active"] then 
                        function_set(v)
                    else
                        function_set(v)
                    end
                end 
            end 
        end 
        
        function library:round(number, float) 
            local multiplier = 1 / (float or 1)
            return floor(number * multiplier + 0.5) / multiplier
        end 

        function library:apply_theme(instance, theme, property) 
            insert(themes.utility[theme][property], instance)
        end

        function library:update_theme(theme, color)
            for _, property in themes.utility[theme] do 
                for m, object in property do 
                    if object[_] == themes.preset[theme] then 
                        object[_] = color 
                    end 
                end 
            end 
            themes.preset[theme] = color 
        end 

        function library:connection(signal, callback)
            local connection = signal:Connect(callback)
            insert(library.connections, connection)
            return connection 
        end

        function library:close_element(new_path) 
            local open_element = library.current_open
            if open_element and new_path ~= open_element then
                open_element.set_visible(false)
                open_element.open = false;
            end 
            if new_path ~= open_element then 
                library.current_open = new_path or nil;
            end
        end 

        function library:create(instance, options)
            local ins = Instance.new(instance) 
            for prop, value in options do 
                ins[prop] = value
            end
            return ins 
        end

        function library:unload_menu() 
            if library[ "items" ] then 
                library[ "items" ]:Destroy()
            end
            if library[ "other" ] then 
                library[ "other" ]:Destroy()
            end 
            for index, connection in library.connections do 
                connection:Disconnect() 
                connection = nil 
            end
            library = nil 
        end 
    --
    
    -- Library element functions
        function library:window(properties)
            local cfg = { 
                suffix = properties.suffix or properties.Suffix or "tech";
                name = properties.name or properties.Name or "nebula";
                game_name = properties.gameInfo or properties.game_info or properties.GameInfo or "Milenium for Counter-Strike: Global Offensive";
                size = properties.size or properties.Size or dim2(0, 700, 0, 565);
                selected_tab;
                items = {};
                tween;
            }
            
            library[ "items" ] = library:create( "ScreenGui" , {
                Parent = coregui;
                Name = "\0";
                Enabled = true;
                ZIndexBehavior = Enum.ZIndexBehavior.Global;
                IgnoreGuiInset = true;
            });
            
            library[ "other" ] = library:create( "ScreenGui" , {
                Parent = coregui;
                Name = "\0";
                Enabled = false;
                ZIndexBehavior = Enum.ZIndexBehavior.Sibling;
                IgnoreGuiInset = true;
            }); 

            local items = cfg.items; do
                items[ "main" ] = library:create( "Frame" , {
                    Parent = library[ "items" ];
                    Size = cfg.size;
                    Name = "\0";
                    Position = dim2(0.5, -cfg.size.X.Offset / 2, 0.5, -cfg.size.Y.Offset / 2);
                    BorderColor3 = rgb(0, 0, 0);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(14, 14, 16)
                }); 
                items[ "main" ].Position = dim2(0, items[ "main" ].AbsolutePosition.X, 0, items[ "main" ].AbsolutePosition.Y)
                
                -- Add mobile scaling
                if isMobile then
                    library:create("UIScale", {
                        Parent = items["main"],
                        Scale = scale
                    })
                end
                
                library:create( "UICorner" , {
                    Parent = items[ "main" ];
                    CornerRadius = dim(0, 10)
                });
                
                library:create( "UIStroke" , {
                    Color = rgb(23, 23, 29);
                    Parent = items[ "main" ];
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border
                });
                
                items[ "side_frame" ] = library:create( "Frame" , {
                    Parent = items[ "main" ];
                    BackgroundTransparency = 1;
                    Name = "\0";
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(0, 196, 1, -25);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(14, 14, 16)
                });
                
                library:create( "Frame" , {
                    AnchorPoint = vec2(1, 0);
                    Parent = items[ "side_frame" ];
                    Position = dim2(1, 0, 0, 0);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(0, 1, 1, 0);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(21, 21, 23)
                });
                
                items[ "button_holder" ] = library:create( "Frame" , {
                    Parent = items[ "side_frame" ];
                    Name = "\0";
                    BackgroundTransparency = 1;
                    Position = dim2(0, 0, 0, 60);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, 0, 1, -60);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); cfg.button_holder = items[ "button_holder" ];
                
                library:create( "UIListLayout" , {
                    Parent = items[ "button_holder" ];
                    Padding = dim(0, 5);
                    SortOrder = Enum.SortOrder.LayoutOrder
                });
                
                library:create( "UIPadding" , {
                    PaddingTop = dim(0, 16);
                    PaddingBottom = dim(0, 36);
                    Parent = items[ "button_holder" ];
                    PaddingRight = dim(0, 11);
                    PaddingLeft = dim(0, 10)
                });

                local accent = themes.preset.accent
                items[ "title" ] = library:create( "TextLabel" , {
                    FontFace = fonts.font;
                    BorderColor3 = rgb(0, 0, 0);
                    Text = name;
                    Parent = items[ "side_frame" ];
                    Name = "\0";
                    Text = string.format('<u>%s</u><font color = "rgb(255, 255, 255)">%s</font>', cfg.name, cfg.suffix);
                    BackgroundTransparency = 1;
                    Size = dim2(1, 0, 0, 70);
                    TextColor3 = themes.preset.accent;
                    BorderSizePixel = 0;
                    RichText = true;
                    TextSize = 30;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); library:apply_theme(items[ "title" ], "accent", "TextColor3");
                
                items[ "multi_holder" ] = library:create( "Frame" , {
                    Parent = items[ "main" ];
                    Name = "\0";
                    BackgroundTransparency = 1;
                    Position = dim2(0, 196, 0, 0);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, -196, 0, 56);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); cfg.multi_holder = items[ "multi_holder" ];
                
                library:create( "Frame" , {
                    AnchorPoint = vec2(0, 1);
                    Parent = items[ "multi_holder" ];
                    Position = dim2(0, 0, 1, 0);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, 0, 0, 1);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(21, 21, 23)
                });
                
                items[ "shadow" ] = library:create( "ImageLabel" , {
                    ImageColor3 = rgb(0, 0, 0);
                    ScaleType = Enum.ScaleType.Slice;
                    Parent = items[ "main" ];
                    BorderColor3 = rgb(0, 0, 0);
                    Name = "\0";
                    BackgroundColor3 = rgb(255, 255, 255);
                    Size = dim2(1, 75, 1, 75);
                    AnchorPoint = vec2(0.5, 0.5);
                    Image = "rbxassetid://112971167999062";
                    BackgroundTransparency = 1;
                    Position = dim2(0.5, 0, 0.5, 0);
                    SliceScale = 0.75;
                    ZIndex = -100;
                    BorderSizePixel = 0;
                    SliceCenter = rect(vec2(112, 112), vec2(147, 147))
                });
                
                items[ "global_fade" ] = library:create( "Frame" , {
                    Parent = items[ "main" ];
                    Name = "\0";
                    BackgroundTransparency = 1;
                    Position = dim2(0, 196, 0, 56);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, -196, 1, -81);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(14, 14, 16);
                    ZIndex = 2;
                });                

                library:create( "UICorner" , {
                    Parent = items[ "shadow" ];
                    CornerRadius = dim(0, 5)
                });
                
                items[ "info" ] = library:create( "Frame" , {
                    AnchorPoint = vec2(0, 1);
                    Parent = items[ "main" ];
                    Name = "\0";
                    Position = dim2(0, 0, 1, 0);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, 0, 0, 25);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(23, 23, 25)
                });
                
                library:create( "UICorner" , {
                    Parent = items[ "info" ];
                    CornerRadius = dim(0, 10)
                });
                
                items[ "grey_fill" ] = library:create( "Frame" , {
                    Name = "\0";
                    Parent = items[ "info" ];
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, 0, 0, 6);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(23, 23, 25)
                });
                
                items[ "game" ] = library:create( "TextLabel" , {
                    FontFace = fonts.font;
                    Parent = items[ "info" ];
                    TextColor3 = rgb(72, 72, 73);
                    BorderColor3 = rgb(0, 0, 0);
                    Text = cfg.game_name;
                    Name = "\0";
                    Size = dim2(1, 0, 0, 0);
                    AnchorPoint = vec2(0, 0.5);
                    Position = dim2(0, 10, 0.5, -1);
                    BackgroundTransparency = 1;
                    TextXAlignment = Enum.TextXAlignment.Left;
                    BorderSizePixel = 0;
                    AutomaticSize = Enum.AutomaticSize.XY;
                    TextSize = 14;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); 
                
                items[ "other_info" ] = library:create( "TextLabel" , {
                    Parent = items[ "info" ];
                    RichText = true;
                    Name = "\0";
                    TextColor3 = themes.preset.accent;
                    BorderColor3 = rgb(0, 0, 0);
                    Text = '<font color="rgb(72, 72, 73)">32 days left, </font>' .. cfg.name .. cfg.suffix;
                    Size = dim2(1, 0, 0, 0);
                    Position = dim2(0, -10, 0.5, -1);
                    AnchorPoint = vec2(0, 0.5);
                    BorderSizePixel = 0;
                    BackgroundTransparency = 1;
                    TextXAlignment = Enum.TextXAlignment.Right;
                    AutomaticSize = Enum.AutomaticSize.XY;
                    FontFace = fonts.font;
                    TextSize = 14;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); library:apply_theme(items[ "other_info" ], "accent", "TextColor3");        
            end 

            -- Mobile close button
            if isMobile then
                items[ "mobile_close" ] = library:create( "TextButton" , {
                    Parent = library[ "items" ];
                    Name = "MobileClose";
                    Position = dim2(0, 20, 1, -20);
                    AnchorPoint = vec2(0, 1);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(0, 75, 0, 50);
                    BorderSizePixel = 0;
                    Text = "Toggle UI";
                    AutoButtonColor = false;
                    Visible = true;
                    BackgroundColor3 = rgb(25, 25, 29)
                });
                
                library:create( "UICorner" , {
                    Parent = items[ "mobile_close" ];
                    CornerRadius = dim(0, 10)
                });
                
                library:create( "UIStroke" , {
                    Color = rgb(23, 23, 29);
                    Parent = items[ "mobile_close" ];
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border
                });

                library:connectInput(items[ "mobile_close" ], function()
                    cfg.toggle_menu(not library[ "items" ].Enabled)
                end, true, true)
            end

            do -- Other
                library:draggify(items[ "main" ])
                library:resizify(items[ "main" ])
            end 

            function cfg.toggle_menu(bool) 
                library[ "items" ].Enabled = bool
            end 
                
            return setmetatable(cfg, library)
        end 

        function library:tab(properties)
            local cfg = {
                name = properties.name or properties.Name or "visuals"; 
                icon = properties.icon or properties.Icon or "http://www.roblox.com/asset/?id=6034767608";
                tabs = properties.tabs or properties.Tabs or {"Main", "Misc.", "Settings"};
                pages = {};
                current_multi; 
                items = {};
            } 

            local items = cfg.items; do 
                items[ "tab_holder" ] = library:create( "Frame" , {
                    Parent = library.cache;
                    Name = "\0";
                    Visible = false;
                    BackgroundTransparency = 1;
                    Position = dim2(0, 196, 0, 56);
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, -216, 1, -101);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                });
                
                -- Tab buttons 
                items[ "button" ] = library:create( "TextButton" , {
                    FontFace = fonts.font;
                    TextColor3 = rgb(255, 255, 255);
                    BorderColor3 = rgb(0, 0, 0);
                    Text = "";
                    Parent = self.items[ "button_holder" ];
                    AutoButtonColor = false;
                    BackgroundTransparency = 1;
                    Name = "\0";
                    Size = dim2(1, 0, 0, 35);
                    BorderSizePixel = 0;
                    TextSize = 16;
                    BackgroundColor3 = rgb(29, 29, 29)
                });
                
                items[ "icon" ] = library:create( "ImageLabel" , {
                    ImageColor3 = rgb(72, 72, 73);
                    BorderColor3 = rgb(0, 0, 0);
                    Parent = items[ "button" ];
                    AnchorPoint = vec2(0, 0.5);
                    Image = cfg.icon;
                    BackgroundTransparency = 1;
                    Position = dim2(0, 10, 0.5, 0);
                    Name = "\0";
                    Size = dim2(0, 22, 0, 22);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                }); library:apply_theme(items[ "icon" ], "accent", "ImageColor3");
                
                items[ "name" ] = library:create( "TextLabel" , {
                    FontFace = fonts.font;
                    TextColor3 = rgb(72, 72, 73);
                    BorderColor3 = rgb(0, 0, 0);
                    Text = cfg.name;
                    Parent = items[ "button" ];
                    Name = "\0";
                    Size = dim2(0, 0, 1, 0);
                    Position = dim2(0, 40, 0, 0);
                    BackgroundTransparency = 1;
                    TextXAlignment = Enum.TextXAlignment.Left;
                    BorderSizePixel = 0;
                    AutomaticSize = Enum.AutomaticSize.X;
                    TextSize = 16;
                    BackgroundColor3 = rgb(255, 255, 255)
                });
                
                library:create( "UIPadding" , {
                    Parent = items[ "name" ];
                    PaddingRight = dim(0, 5);
                    PaddingLeft = dim(0, 5)
                });
                
                library:create( "UICorner" , {
                    Parent = items[ "button" ];
                    CornerRadius = dim(0, 7)
                });
                
                library:create( "UIStroke" , {
                    Color = rgb(23, 23, 29);
                    Parent = items[ "button" ];
                    Enabled = false;
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border
                });

                -- Multi Sections
                items[ "multi_section_button_holder" ] = library:create( "Frame" , {
                    Parent = library.cache;
                    BackgroundTransparency = 1;
                    Name = "\0";
                    Visible = false;
                    BorderColor3 = rgb(0, 0, 0);
                    Size = dim2(1, 0, 1, 0);
                    BorderSizePixel = 0;
                    BackgroundColor3 = rgb(255, 255, 255)
                });
                
                library:create( "UIListLayout" , {
                    Parent = items[ "multi_section_button_holder" ];
                    Padding = dim(0, 7);
                    SortOrder = Enum.SortOrder.LayoutOrder;
                    FillDirection = Enum.FillDirection.Horizontal
                });
                
                library:create( "UIPadding" , {
                    PaddingTop = dim(0, 8);
                    PaddingBottom = dim(0, 7);
                    Parent = items[ "multi_section_button_holder" ];
                    PaddingRight = dim(0, 7);
                    PaddingLeft = dim(0, 7)
                });                        

                for _, section in cfg.tabs do
                    local data = {items = {}} 
                    local multi_items = data.items; do 
                        -- Button
                        multi_items[ "button" ] = library:create( "TextButton" , {
                            FontFace = fonts.font;
                            TextColor3 = rgb(255, 255, 255);
                            BorderColor3 = rgb(0, 0, 0);
                            AutoButtonColor = false;
                            Text = "";
                            Parent = items[ "multi_section_button_holder" ];
                            Name = "\0";
                            Size = dim2(0, 0, 0, 39);
                            BackgroundTransparency = 1;
                            ClipsDescendants = true;
                            BorderSizePixel = 0;
                            AutomaticSize = Enum.AutomaticSize.X;
                            TextSize = 16;
                            BackgroundColor3 = rgb(25, 25, 29)
                        });
                        
                        multi_items[ "name" ] = library:create( "TextLabel" , {
                            FontFace = fonts.font;
                            TextColor3 = rgb(62, 62, 63);
                            BorderColor3 = rgb(0, 0, 0);
                            Text = section;
                            Parent = multi_items[ "button" ];
                            Name = "\0";
                            Size = dim2(0, 0, 1, 0);
                            BackgroundTransparency = 1;
                            TextXAlignment = Enum.TextXAlignment.Left;
                            BorderSizePixel = 0;
                            AutomaticSize = Enum.AutomaticSize.XY;
                            TextSize = 16;
                            BackgroundColor3 = rgb(255, 255, 255)
                        });
                        
                        library:create( "UIPadding" , {
                            Parent = multi_items[ "name" ];
                            PaddingRight = dim(0, 5);
                            PaddingLeft = dim(0, 5)
                        });
                        
                        multi_items[ "accent" ] = library:create( "Frame" , {
                            BorderColor3 = rgb(0, 0, 0);
                            AnchorPoint = vec2(0, 1);
                            Parent = multi_items[ "button" ];
                            BackgroundTransparency = 1;
                            Position = dim2(0, 10, 1, 4);
                            Name = "\0";
                            Size = dim2(1, -20, 0, 6);
                            BorderSizePixel = 0;
                            BackgroundColor3 = themes.preset.accent
                        }); library:apply_theme(multi_items[ "accent" ], "accent", "BackgroundColor3");
                        
                        library:create( "UICorner" , {
                            Parent = multi_items[ "accent" ];
                            CornerRadius = dim(0, 999)
                        });
                        
                        library:create( "UIPadding" , {
                            Parent = multi_items[ "button" ];
                            PaddingRight = dim(0, 10);
                            PaddingLeft = dim(0, 10)
                        });
                        
                        library:create( "UICorner" , {
                            Parent = multi_items[ "button" ];
                            CornerRadius = dim(0, 7)
                        }); 

                        -- Tab 
                        multi_items[ "tab" ] = library:create( "Frame" , {
                            Parent = library.cache;
                            BackgroundTransparency = 1;
                            Name = "\0";
                            BorderColor3 = rgb(0, 0, 0);
                            Size = dim2(1, -20, 1, -20);
                            BorderSizePixel = 0;
                            Visible = false;
                            BackgroundColor3 = rgb(255, 255, 255)
                        });
                        
                        library:create( "UIListLayout" , {
                            FillDirection = Enum.FillDirection.Vertical;
                            HorizontalFlex = Enum.UIFlexAlignment.Fill;
                            Parent = multi_items[ "tab" ];
                            Padding = dim(0, 7);
                            SortOrder = Enum.SortOrder.LayoutOrder;
                            VerticalFlex = Enum.UIFlexAlignment.Fill
                        });
                        
                        library:create( "UIPadding" , {
                            PaddingTop = dim(0, 7);
                            PaddingBottom = dim(0, 7);
                            Parent = multi_items[ "tab" ];
                            PaddingRight = dim(0, 7);
                            PaddingLeft = dim(0, 7)
                        });
                    end

                    data.text = multi_items[ "name" ]
                    data.accent = multi_items[ "accent" ]
                    data.button = multi_items[ "button" ]
                    data.page = multi_items[ "tab" ]
                    data.parent = setmetatable(data, library):sub_tab({}).items[ "tab_parent" ]
                    
                    function data.open_page()
                        local page = cfg.current_multi; 
                        if page and page.text ~= data.text then 
                            self.items[ "global_fade" ].BackgroundTransparency = 0
                            library:tween(self.items[ "global_fade" ], {BackgroundTransparency = 1}, Enum.EasingStyle.Quad, 0.4)
                            local old_size = page.page.Size
                            page.page.Size = dim2(1, -20, 1, -20)
                        end

                        if page then
                            library:tween(page.text, {TextColor3 = rgb(62, 62, 63)})
                            library:tween(page.accent, {BackgroundTransparency = 1})
                            library:tween(page.button, {BackgroundTransparency = 1})
                            page.page.Visible = false
                            page.page.Parent = library[ "cache" ] 
                        end 
                        
                        library:tween(data.text, {TextColor3 = rgb(255, 255, 255)})
                        library:tween(data.accent, {BackgroundTransparency = 0})
                        library:tween(data.button, {BackgroundTransparency = 0})
                        library:tween(data.page, {Size = dim2(1, 0, 1, 0)}, Enum.EasingStyle.Quad, 0.4)
                        data.page.Visible = true
                        data.page.Parent = items["tab_holder"]
                        cfg.current_multi = data
                        library:close_element()
                    end

                    library:connectInput(multi_items[ "button" ], function()
                        data.open_page() 
                    end, true, true)

                    cfg.pages[#cfg.pages + 1] = setmetatable(data, library)
                end 
                cfg.pages[1].open_page()
            end 

            function cfg.open_tab() 
                local selected_tab = self.selected_tab
                if selected_tab then 
                    if selected_tab[ 4 ] ~= items[ "tab_holder" ] then 
                        self.items[ "global_fade" ].BackgroundTransparency = 0
                        library:tween(self.items[ "global_fade" ], {BackgroundTransparency = 1}, Enum.EasingStyle.Quad, 0.4)
                        selected_tab[ 4 ].Size = dim2(1, -216, 1, -101)
                    end
                    library:tween(selected_tab[ 1 ], {BackgroundTransparency = 1})
                    library:tween(selected_tab[ 2 ], {ImageColor3 = rgb(72, 72, 73)})
                    library:tween(selected_tab[ 3 ], {TextColor3 = rgb(72, 72, 73)})
                    selected_tab[ 4 ].Visible = false
                    selected_tab[ 4 ].Parent = library[ "cache" ]
                    selected_tab[ 5 ].Visible = false
                    selected_tab[ 5 ].Parent = library[ "cache" ]
                end

                library:tween(items[ "button" ], {BackgroundTransparency = 0})
                library:tween(items[ "icon" ], {ImageColor3 = themes.preset.accent})
                library:tween(items[ "name" ], {TextColor3 = rgb(255, 255, 255)})
                library:tween(items[ "tab_holder" ], {Size = dim2(1, -196, 1, -81)}, Enum.EasingStyle.Quad, 0.4)
                items[ "tab_holder" ].Visible = true 
                items[ "tab_holder" ].Parent = self.items[ "main" ]
                items[ "multi_section_button_holder" ].Visible = true 
                items[ "multi_section_button_holder" ].Parent = self.items[ "multi_holder" ]
                self.selected_tab = {
                    items[ "button" ];
                    items[ "icon" ];
                    items[ "name" ];
                    items[ "tab_holder" ];
                    items[ "multi_section_button_holder" ];
                }
                library:close_element()
            end

            library:connectInput(items[ "button" ], function()
                cfg.open_tab()
            end, true, true)
            
            if not self.selected_tab then 
                cfg.open_tab(true) 
            end
            return unpack(cfg.pages)
        end

        -- ... (rest of the UI elements follow the same pattern - replace MouseButton1Click with library:connectInput)

        -- Update all UI elements to use the unified input system:
        -- Replace: element.MouseButton1Click:Connect(function() ... end)
        -- With: library:connectInput(element, function() ... end, true, true)

        -- Example for toggle:
        function library:toggle(options) 
            local cfg = {
                -- ... existing toggle config
            }
            -- ... existing toggle creation code

            -- Replace old input handlers:
            library:connectInput(items[ "toggle" ], function()
                cfg.enabled = not cfg.enabled 
                cfg.set(cfg.enabled)
            end, true, true)

            library:connectInput(items[ "toggle_button" ], function()
                cfg.enabled = not cfg.enabled 
                cfg.set(cfg.enabled)
            end, true, true)

            -- ... rest of toggle code
            return setmetatable(cfg, library)
        end

        -- Apply similar changes to ALL other UI elements:
        -- slider, dropdown, colorpicker, textbox, keybind, button, etc.

    -- Notification Library (updated for mobile)
    function notifications:refresh_notifs() 
        local offset = 50
        for i, v in notifications.notifs do
            local Position = vec2(20, offset)
            library:tween(v, {Position = dim_offset(Position.X, Position.Y)}, Enum.EasingStyle.Quad, 0.4)
            offset += (v.AbsoluteSize.Y + 10)
        end
        return offset
    end
    
    function notifications:fade(path, is_fading)
        local fading = is_fading and 1 or 0 
        library:tween(path, {BackgroundTransparency = fading}, Enum.EasingStyle.Quad, 1)
        for _, instance in path:GetDescendants() do 
            if not instance:IsA("GuiObject") then 
                if instance:IsA("UIStroke") then
                    library:tween(instance, {Transparency = fading}, Enum.EasingStyle.Quad, 1)
                end
                continue
            end 
            if instance:IsA("TextLabel") then
                library:tween(instance, {TextTransparency = fading})
            elseif instance:IsA("Frame") then
                library:tween(instance, {BackgroundTransparency = instance.Transparency and 0.6 and is_fading and 1 or 0.6}, Enum.EasingStyle.Quad, 1)
            end
        end
    end 
    
    function notifications:create_notification(options)
        local cfg = {
            name = options.name or "This is a title!";
            info = options.info or "This is extra info!";
            lifetime = options.lifetime or 3;
            items = {};
            outline;
        }

        local items = cfg.items; do 
            items[ "notification" ] = library:create( "Frame" , {
                Parent = library[ "items" ];
                Size = dim2(0, 210, 0, 53);
                Name = "\0";
                BorderColor3 = rgb(0, 0, 0);
                BorderSizePixel = 0;
                BackgroundTransparency = 1;
                AnchorPoint = vec2(1, 0);
                AutomaticSize = Enum.AutomaticSize.Y;
                BackgroundColor3 = rgb(14, 14, 16)
            });
            
            -- Add mobile scaling to notifications
            if isMobile then
                library:create("UIScale", {
                    Parent = items["notification"],
                    Scale = scale
                })
            end
            
            library:create( "UIStroke" , {
                Color = rgb(23, 23, 29);
                Parent = items[ "notification" ];
                Transparency = 1;
                ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            });
            
            items[ "title" ] = library:create( "TextLabel" , {
                FontFace = fonts.font;
                TextColor3 = rgb(255, 255, 255);
                BorderColor3 = rgb(0, 0, 0);
                Text = cfg.name;
                Parent = items[ "notification" ];
                Name = "\0";
                BackgroundTransparency = 1;
                Position = dim2(0, 7, 0, 6);
                BorderSizePixel = 0;
                AutomaticSize = Enum.AutomaticSize.XY;
                TextSize = 14;
                BackgroundColor3 = rgb(255, 255, 255)
            });
            
            library:create( "UICorner" , {
                Parent = items[ "notification" ];
                CornerRadius = dim(0, 3)
            });
            
            items[ "info" ] = library:create( "TextLabel" , {
                FontFace = fonts.font;
                TextColor3 = rgb(145, 145, 145);
                BorderColor3 = rgb(0, 0, 0);
                Text = cfg.info;
                Parent = items[ "notification" ];
                Name = "\0";
                Position = dim2(0, 9, 0, 22);
                BorderSizePixel = 0;
                BackgroundTransparency = 1;
                TextXAlignment = Enum.TextXAlignment.Left;
                TextWrapped = true;
                AutomaticSize = Enum.AutomaticSize.XY;
                TextSize = 14;
                BackgroundColor3 = rgb(255, 255, 255)
            });
            
            library:create( "UIPadding" , {
                PaddingBottom = dim(0, 17);
                PaddingRight = dim(0, 8);
                Parent = items[ "info" ]
            });
            
            items[ "bar" ] = library:create( "Frame" , {
                AnchorPoint = vec2(0, 1);
                Parent = items[ "notification" ];
                Name = "\0";
                Position = dim2(0, 8, 1, -6);
                BorderColor3 = rgb(0, 0, 0);
                Size = dim2(0, 0, 0, 5);
                BackgroundTransparency = 1;
                BorderSizePixel = 0;
                BackgroundColor3 = themes.preset.accent
            });
            
            library:create( "UICorner" , {
                Parent = items[ "bar" ];
                CornerRadius = dim(0, 999)
            });
            
            library:create( "UIPadding" , {
                PaddingRight = dim(0, 8);
                Parent = items[ "notification" ]
            });
        end
        
        local index = #notifications.notifs + 1
        notifications.notifs[index] = items[ "notification" ]
        notifications:fade(items[ "notification" ], false)
        local offset = notifications:refresh_notifs()
        items[ "notification" ].Position = dim_offset(20, offset)
        library:tween(items[ "notification" ], {AnchorPoint = vec2(0, 0)}, Enum.EasingStyle.Quad, 1)
        library:tween(items[ "bar" ], {Size = dim2(1, -8, 0, 5)}, Enum.EasingStyle.Quad, cfg.lifetime)

        task.spawn(function()
            task.wait(cfg.lifetime)
            notifications.notifs[index] = nil
            notifications:fade(items[ "notification" ], true)
            library:tween(items[ "notification" ], {AnchorPoint = vec2(1, 0)}, Enum.EasingStyle.Quad, 1)
            task.wait(1)
            items[ "notification" ]:Destroy() 
        end)
    end

return library
