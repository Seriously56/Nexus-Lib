-- Nexus UI Library (Max Money Style with Full Functionality)
-- Combines the visual design of AutoDupe GUI with Linoria's element functionality

local NexusUI = {}
local cloneref = (cloneref or clonereference or function(instance) return instance end)

-- Services
local Players = game:GetService("Players")
local UserInputService = cloneref(game:GetService('UserInputService'))
local TextService = cloneref(game:GetService('TextService'))
local CoreGui = cloneref(game:GetService('CoreGui'))
local RunService = cloneref(game:GetService('RunService'))
local TweenService = cloneref(game:GetService('TweenService'))
local RenderStepped = RunService.RenderStepped

-- Constants
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- ========================================
-- MAX MONEY STYLE COLOR SCHEME
-- ========================================
local Colors = {
    Background = Color3.fromRGB(15, 8, 15),
    Surface = Color3.fromRGB(25, 15, 25),
    Primary = Color3.fromRGB(40, 25, 35),
    Secondary = Color3.fromRGB(40, 28, 38),
    Border = Color3.fromRGB(60, 40, 55),
    TextPrimary = Color3.fromRGB(255, 240, 245),
    TextSecondary = Color3.fromRGB(200, 170, 185),
    Success = Color3.fromRGB(100, 255, 150),
    Error = Color3.fromRGB(255, 100, 130),
    Warning = Color3.fromRGB(255, 200, 100),
    Discord = Color3.fromRGB(180, 65, 160),
    GetKey = Color3.fromRGB(255, 105, 180),
    HoverPrimary = Color3.fromRGB(50, 35, 45),
    HoverGetKey = Color3.fromRGB(255, 120, 200),
    HoverDiscord = Color3.fromRGB(200, 85, 180),
    
    -- Gradient colors from Max Money
    PinkLight = Color3.fromRGB(255, 182, 193),
    PinkMedium = Color3.fromRGB(255, 105, 180),
    PinkDark = Color3.fromRGB(255, 20, 147),
    PinkBright = Color3.fromRGB(255, 130, 190),
    PinkNeon = Color3.fromRGB(255, 60, 160)
}

-- ========================================
-- CORE LIBRARY SETUP
-- ========================================
local ScreenGui = Instance.new('ScreenGui')
ScreenGui.Name = "NexusUILibrary"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
ScreenGui.DisplayOrder = 999
ScreenGui.ResetOnSpawn = false

if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
else
    ScreenGui.Parent = CoreGui
end

-- Global tables
local Toggles = {}
local Options = {}
local Labels = {}
local Buttons = {}

-- Library table
local Library = {
    Toggles = Toggles,
    Options = Options,
    Labels = Labels,
    Buttons = Buttons,
    ScreenGui = ScreenGui,
    
    -- Colors
    FontColor = Colors.TextPrimary,
    MainColor = Colors.Surface,
    BackgroundColor = Colors.Background,
    AccentColor = Colors.PinkMedium,
    OutlineColor = Colors.Border,
    
    -- States
    OpenedFrames = {},
    Registry = {},
    RegistryMap = {},
    Signals = {},
    
    -- Settings
    ShowCustomCursor = true,
    IsMobile = (UserInputService.TouchEnabled and not UserInputService.MouseEnabled),
    CanDrag = true
}

-- ========================================
-- PARTICLE SYSTEM (MAX MONEY STYLE)
-- ========================================
local ParticleState = {
    Particles = {},
    IsDestroyed = false,
    MousePosition = {X = 0, Y = 0},
    GuiBounds = {MinX = 0, MaxX = 0, MinY = 0, MaxY = 0}
}

local function UpdateGuiBounds(container)
    if not container then return end
    local absolutePosition = container.AbsolutePosition
    local absoluteSize = container.AbsoluteSize
    
    ParticleState.GuiBounds = {
        MinX = absolutePosition.X,
        MaxX = absolutePosition.X + absoluteSize.X,
        MinY = absolutePosition.Y,
        MaxY = absolutePosition.Y + absoluteSize.Y
    }
end

local function CreateParticle(container)
    if not container or not container.Parent or ParticleState.IsDestroyed then
        return nil
    end
    
    local size = math.random(8, 24)
    local particle = Instance.new('Frame')
    particle.Size = UDim2.new(0, size, 0, size)
    
    local startX = math.random(0, 100) / 100
    local startY = math.random(0, 100) / 100
    particle.Position = UDim2.new(startX, 0, startY, 0)
    
    particle.BackgroundColor3 = Colors.PinkLight
    particle.BackgroundTransparency = math.random(60, 85) / 100
    particle.BorderSizePixel = 0
    particle.ZIndex = 5
    particle.Selectable = false
    particle.Parent = container
    
    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = particle
    
    local gradient = Instance.new('UIGradient')
    local bubbleColors = {
        Colors.PinkLight,
        Colors.PinkMedium,
        Colors.PinkDark,
        Color3.fromRGB(255, 150, 200)
    }
    local color1 = bubbleColors[math.random(#bubbleColors)]
    local color2 = bubbleColors[math.random(#bubbleColors)]
    
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, color1),
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255, 220, 230)),
        ColorSequenceKeypoint.new(0.7, color2),
        ColorSequenceKeypoint.new(1, color1)
    })
    gradient.Rotation = math.random(0, 360)
    gradient.Parent = particle
    
    local particleData = {
        frame = particle,
        vx = (math.random() - 0.5) * 0.002,
        vy = (math.random() - 0.5) * 0.002,
        created = tick(),
        rotation = 0,
        rotationSpeed = (math.random() - 0.5) * 2,
        pulsePhase = math.random() * math.pi * 2,
        originalTransparency = particle.BackgroundTransparency,
        lifetime = math.random(30, 60),
        originalSize = size,
        repelForce = {x = 0, y = 0},
        mass = size / 10
    }
    
    table.insert(ParticleState.Particles, particleData)
    return particle
end

local function UpdateParticles(container)
    if ParticleState.IsDestroyed or not container then return end
    
    UpdateGuiBounds(container)
    
    local screenSize = container.AbsoluteSize
    local mouseScreenX = (ParticleState.MousePosition.X - ParticleState.GuiBounds.MinX) / screenSize.X
    local mouseScreenY = (ParticleState.MousePosition.Y - ParticleState.GuiBounds.MinY) / screenSize.Y
    
    for i = #ParticleState.Particles, 1, -1 do
        local p = ParticleState.Particles[i]
        
        if not p or not p.frame or not p.frame.Parent then
            table.remove(ParticleState.Particles, i)
        else
            local currentPos = p.frame.Position
            local age = tick() - p.created
            
            if age > p.lifetime then
                p.frame:Destroy()
                table.remove(ParticleState.Particles, i)
            else
                local distanceToMouse = math.sqrt(
                    (currentPos.X.Scale - mouseScreenX)^2 + 
                    (currentPos.Y.Scale - mouseScreenY)^2
                )
                
                local repelStrength = 0.08
                local repelRadius = 0.15
                local repelForceX = 0
                local repelForceY = 0
                
                if distanceToMouse < repelRadius and distanceToMouse > 0 then
                    local repelPower = (repelRadius - distanceToMouse) / repelRadius
                    repelPower = repelPower * repelStrength / p.mass
                    
                    local directionX = (currentPos.X.Scale - mouseScreenX) / distanceToMouse
                    local directionY = (currentPos.Y.Scale - mouseScreenY) / distanceToMouse
                    
                    repelForceX = directionX * repelPower
                    repelForceY = directionY * repelPower
                end
                
                p.repelForce.x = p.repelForce.x * 0.85 + repelForceX * 0.15
                p.repelForce.y = p.repelForce.y * 0.85 + repelForceY * 0.15
                
                local newX = currentPos.X.Scale + p.vx + p.repelForce.x
                local newY = currentPos.Y.Scale + p.vy + p.repelForce.y
                
                if newX < 0 then 
                    newX = 0 
                    p.vx = math.abs(p.vx) * 0.5
                elseif newX > 1 then 
                    newX = 1 
                    p.vx = -math.abs(p.vx) * 0.5
                end
                
                if newY < 0 then 
                    newY = 0 
                    p.vy = math.abs(p.vy) * 0.5
                elseif newY > 1 then 
                    newY = 1 
                    p.vy = -math.abs(p.vy) * 0.5
                end
                
                p.rotation = p.rotation + p.rotationSpeed
                p.frame.Rotation = p.rotation
                
                local breathe = math.sin(tick() * 2.5 + p.pulsePhase) * 0.1 + 1
                local currentSize = p.originalSize * breathe
                p.frame.Size = UDim2.new(0, currentSize, 0, currentSize)
                
                p.vx = p.vx * 0.995
                p.vy = p.vy * 0.998
                
                p.frame.Position = UDim2.new(newX, 0, newY, 0)
            end
        end
    end
end

local function StartParticleSystem(container)
    UpdateGuiBounds(container)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = input.Position
            if mousePos.X >= ParticleState.GuiBounds.MinX and mousePos.X <= ParticleState.GuiBounds.MaxX and
               mousePos.Y >= ParticleState.GuiBounds.MinY and mousePos.Y <= ParticleState.GuiBounds.MaxY then
                ParticleState.MousePosition.X = mousePos.X
                ParticleState.MousePosition.Y = mousePos.Y
            end
        end
    end)
    
    task.spawn(function()
        for i = 1, 20 do
            if ParticleState.IsDestroyed then break end
            CreateParticle(container)
            task.wait(math.random(20, 100) / 1000)
        end
        
        while not ParticleState.IsDestroyed and container.Parent do
            if #ParticleState.Particles < 40 then
                CreateParticle(container)
            end
            task.wait(math.random(400, 1200) / 1000)
        end
    end)
    
    task.spawn(function()
        while not ParticleState.IsDestroyed and container.Parent do
            pcall(function() UpdateParticles(container) end)
            task.wait(1/60)
        end
    end)
end

-- ========================================
-- UTILITY FUNCTIONS
-- ========================================
function Library:SafeCallback(Func, ...)
    if not (Func and typeof(Func) == "function") then
        return
    end

    local run = function(func, ...)
        local Success, Response = pcall(func, ...)
        if Success then
            return Response
        end
        warn("NexusUI Callback Error:", Response)
    end

    task.spawn(run, Func, ...)
end

function Library:Create(Class, Properties)
    local _Instance = typeof(Class) == "string" and Instance.new(Class) or Class

    for Property, Value in next, Properties do
        local success = pcall(function()
            _Instance[Property] = Value
        end)
        if not success then
            warn(`Failed to set property {Property} on {_Instance.ClassName}`)
        end
    end

    return _Instance
end

function Library:AddToRegistry(Instance, Properties)
    local Idx = #Library.Registry + 1
    local Data = {
        Instance = Instance,
        Properties = Properties,
        Idx = Idx
    }

    table.insert(Library.Registry, Data)
    Library.RegistryMap[Instance] = Data
end

function Library:MouseIsOverOpenedFrame()
    for Frame, _ in next, Library.OpenedFrames do
        local AbsPos, AbsSize = Frame.AbsolutePosition, Frame.AbsoluteSize
        if Mouse.X >= AbsPos.X and Mouse.X <= AbsPos.X + AbsSize.X and
           Mouse.Y >= AbsPos.Y and Mouse.Y <= AbsPos.Y + AbsSize.Y then
            return true
        end
    end
    return false
end

-- ========================================
-- WINDOW CREATION (MAX MONEY STYLE)
-- ========================================
function Library:CreateWindow(Config)
    Config = Config or {}
    
    local Window = {
        Tabs = {},
        Groupboxes = {}
    }

    -- Main Container
    local MainContainer = Library:Create("Frame", {
        Size = Config.Size or UDim2.new(0, 550, 0, 600),
        Position = Config.Position or UDim2.new(0.5, -275, 0.5, -300),
        BackgroundColor3 = Colors.Surface,
        BorderSizePixel = 0,
        ZIndex = 1000,
        Parent = ScreenGui
    })

    local Corner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 20),
        Parent = MainContainer
    })

    local Stroke = Library:Create("UIStroke", {
        Color = Colors.PinkMedium,
        Thickness = 2,
        Transparency = 0.2,
        Parent = MainContainer
    })

    -- Particle Container
    local ParticleContainer = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ZIndex = 5,
        Parent = MainContainer
    })

    -- Animated Border
    local AnimatedBorder = Library:Create("Frame", {
        Size = UDim2.new(1, 8, 1, 8),
        Position = UDim2.new(0, -4, 0, -4),
        BackgroundTransparency = 1,
        ZIndex = 999,
        Parent = MainContainer
    })

    local BorderCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 24),
        Parent = AnimatedBorder
    })

    local BorderStroke = Library:Create("UIStroke", {
        Color = Colors.PinkLight,
        Thickness = 3,
        Transparency = 0.3,
        Parent = AnimatedBorder
    })

    local BorderGradient = Library:Create("UIGradient", {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Colors.PinkLight),
            ColorSequenceKeypoint.new(0.3, Colors.PinkMedium),
            ColorSequenceKeypoint.new(0.7, Colors.PinkDark),
            ColorSequenceKeypoint.new(1, Colors.PinkLight)
        },
        Transparency = NumberSequence.new{
            NumberSequenceKeypoint.new(0, 0.8),
            NumberSequenceKeypoint.new(0.2, 0.1),
            NumberSequenceKeypoint.new(0.8, 0.1),
            NumberSequenceKeypoint.new(1, 0.8)
        },
        Parent = BorderStroke
    })

    -- Header
    local Header = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 80),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = MainContainer
    })

    local TitleContainer = Library:Create("Frame", {
        Size = UDim2.new(1, -40, 0, 70),
        Position = UDim2.new(0, 20, 0, 5),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = Header
    })

    local NexusText = Library:Create("TextLabel", {
        Size = UDim2.new(1, 0, 0.5, 0),
        BackgroundTransparency = 1,
        Text = "NEXUS",
        TextColor3 = Colors.TextPrimary,
        TextScaled = true,
        Font = Enum.Font.GothamBlack,
        TextStrokeTransparency = 0.7,
        TextStrokeColor3 = Colors.PinkDark,
        ZIndex = 1002,
        Parent = TitleContainer
    })

    local NexusGradient = Library:Create("UIGradient", {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Colors.PinkLight),
            ColorSequenceKeypoint.new(0.5, Colors.PinkMedium),
            ColorSequenceKeypoint.new(1, Colors.PinkDark)
        },
        Rotation = 45,
        Parent = NexusText
    })

    local UItext = Library:Create("TextLabel", {
        Size = UDim2.new(1, 0, 0.5, 0),
        Position = UDim2.new(0, 0, 0.5, 0),
        BackgroundTransparency = 1,
        Text = "UI LIBRARY",
        TextColor3 = Colors.TextPrimary,
        TextScaled = true,
        Font = Enum.Font.GothamBlack,
        TextStrokeTransparency = 0.7,
        TextStrokeColor3 = Colors.PinkDark,
        ZIndex = 1002,
        Parent = TitleContainer
    })

    local UITextGradient = Library:Create("UIGradient", {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Colors.PinkDark),
            ColorSequenceKeypoint.new(0.5, Colors.PinkMedium),
            ColorSequenceKeypoint.new(1, Colors.PinkLight)
        },
        Rotation = -45,
        Parent = UItext
    })

    -- Content Area
    local Content = Library:Create("Frame", {
        Size = UDim2.new(1, -40, 1, -100),
        Position = UDim2.new(0, 20, 0, 90),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = MainContainer
    })

    -- Tab Container
    local TabContainer = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = Content
    })

    -- Tab Buttons
    local TabButtons = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = TabContainer
    })

    local TabListLayout = Library:Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 5),
        Parent = TabButtons
    })

    -- Tab Content
    local TabContent = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 1, -40),
        Position = UDim2.new(0, 0, 0, 40),
        BackgroundTransparency = 1,
        ZIndex = 1001,
        Parent = TabContainer
    })

    -- Make draggable
    Library:MakeDraggable(Header, MainContainer)

    -- Start animations and particles
    Library:StartBorderAnimation(BorderGradient)
    StartParticleSystem(ParticleContainer)

    -- Window functions
    function Window:AddTab(Name)
        local Tab = {
            Name = Name,
            Elements = {}
        }

        -- Tab Button
        local TabButton = Library:Create("TextButton", {
            Size = UDim2.new(0, 100, 1, 0),
            BackgroundColor3 = Colors.Primary,
            BorderSizePixel = 0,
            Text = Name,
            TextColor3 = Colors.TextPrimary,
            TextSize = 14,
            Font = Enum.Font.GothamBold,
            AutoButtonColor = false,
            ZIndex = 1002,
            Parent = TabButtons
        })

        local TabCorner = Library:Create("UICorner", {
            CornerRadius = UDim.new(0, 8),
            Parent = TabButton
        })

        local TabGradient = Library:Create("UIGradient", {
            Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Colors.PinkDark),
                ColorSequenceKeypoint.new(1, Colors.PinkMedium)
            },
            Rotation = 90,
            Parent = TabButton
        })

        -- Tab Content Frame
        local TabFrame = Library:Create("ScrollingFrame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            ScrollBarThickness = 3,
            ScrollBarImageColor3 = Colors.PinkMedium,
            Visible = false,
            ZIndex = 1001,
            Parent = TabContent
        })

        local TabLayout = Library:Create("UIListLayout", {
            Padding = UDim.new(0, 5),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = TabFrame
        })

        Library:Create("UIPadding", {
            PaddingTop = UDim.new(0, 5),
            PaddingLeft = UDim.new(0, 5),
            Parent = TabFrame
        })

        -- Tab functionality
        function Tab:Show()
            for _, otherTab in pairs(Window.Tabs) do
                otherTab.Frame.Visible = false
                otherTab.Button.BackgroundColor3 = Colors.Primary
            end
            TabFrame.Visible = true
            TabButton.BackgroundColor3 = Colors.PinkMedium
        end

        function Tab:Hide()
            TabFrame.Visible = false
            TabButton.BackgroundColor3 = Colors.Primary
        end

        TabButton.MouseButton1Click:Connect(function()
            Tab:Show()
        end)

        -- Store tab
        Tab.Button = TabButton
        Tab.Frame = TabFrame
        Window.Tabs[Name] = Tab

        -- Show first tab
        if #Window.Tabs == 1 then
            Tab:Show()
        end

        return Tab
    end

    function Window:Toggle()
        MainContainer.Visible = not MainContainer.Visible
    end

    -- Make window methods available
    Window.MainContainer = MainContainer
    Window.Content = Content

    return Window
end

-- ========================================
-- DRAGGABLE FUNCTIONALITY
-- ========================================
function Library:MakeDraggable(Frame, MainFrame)
    Frame.Active = true

    local dragging = false
    local dragInput, dragStart, startPos

    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- ========================================
-- ANIMATION SYSTEM
-- ========================================
function Library:StartBorderAnimation(Gradient)
    local tween = TweenService:Create(Gradient, 
        TweenInfo.new(4, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1), 
        {Rotation = 360})
    tween:Play()
end

-- ========================================
-- UI ELEMENTS (LINORIA-STYLE FUNCTIONALITY)
-- ========================================
function Library:AddToggle(Tab, Config)
    Config = Config or {}
    
    local Toggle = {
        Value = Config.Default or false,
        Type = "Toggle",
        Callback = Config.Callback or function() end
    }

    local ToggleFrame = Library:Create("Frame", {
        Size = UDim2.new(1, -10, 0, 30),
        BackgroundTransparency = 1,
        LayoutOrder = #Tab.Frame:GetChildren(),
        Parent = Tab.Frame
    })

    local ToggleButton = Library:Create("TextButton", {
        Size = UDim2.new(0, 50, 0, 25),
        Position = UDim2.new(1, -55, 0.5, -12.5),
        BackgroundColor3 = Toggle.Value and Colors.PinkMedium or Colors.Primary,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        ZIndex = 1002,
        Parent = ToggleFrame
    })

    local ToggleCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = ToggleButton
    })

    local ToggleLabel = Library:Create("TextLabel", {
        Size = UDim2.new(1, -60, 1, 0),
        BackgroundTransparency = 1,
        Text = Config.Text or "Toggle",
        TextColor3 = Colors.TextPrimary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        Font = Enum.Font.Gotham,
        ZIndex = 1002,
        Parent = ToggleFrame
    })

    function Toggle:SetValue(Value)
        Toggle.Value = Value
        ToggleButton.BackgroundColor3 = Value and Colors.PinkMedium or Colors.Primary
        Library:SafeCallback(Toggle.Callback, Value)
    end

    ToggleButton.MouseButton1Click:Connect(function()
        Toggle:SetValue(not Toggle.Value)
    end)

    -- Add hover effects
    Library:AddHoverEffect(ToggleButton, Colors.HoverPrimary, ToggleButton.BackgroundColor3)

    Toggles[Config.Flag or "Toggle_" .. #Toggles + 1] = Toggle
    return Toggle
end

function Library:AddButton(Tab, Config)
    Config = Config or {}
    
    local Button = {
        Type = "Button",
        Callback = Config.Callback or function() end
    }

    local ButtonFrame = Library:Create("Frame", {
        Size = UDim2.new(1, -10, 0, 35),
        BackgroundTransparency = 1,
        LayoutOrder = #Tab.Frame:GetChildren(),
        Parent = Tab.Frame
    })

    local ButtonElement = Library:Create("TextButton", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Colors.GetKey,
        BorderSizePixel = 0,
        Text = Config.Text or "Button",
        TextColor3 = Colors.TextPrimary,
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false,
        ZIndex = 1002,
        Parent = ButtonFrame
    })

    local ButtonCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = ButtonElement
    })

    local ButtonGradient = Library:Create("UIGradient", {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Colors.PinkMedium),
            ColorSequenceKeypoint.new(1, Colors.PinkBright)
        },
        Rotation = 90,
        Parent = ButtonElement
    })

    ButtonElement.MouseButton1Click:Connect(function()
        Library:SafeCallback(Button.Callback)
    end)

    -- Add hover effects
    Library:AddHoverEffect(ButtonElement, Colors.HoverGetKey, Colors.GetKey)

    Buttons[Config.Flag or "Button_" .. #Buttons + 1] = Button
    return Button
end

function Library:AddSlider(Tab, Config)
    Config = Config or {}
    
    local Slider = {
        Value = Config.Default or Config.Min or 0,
        Min = Config.Min or 0,
        Max = Config.Max or 100,
        Type = "Slider",
        Callback = Config.Callback or function() end
    }

    local SliderFrame = Library:Create("Frame", {
        Size = UDim2.new(1, -10, 0, 50),
        BackgroundTransparency = 1,
        LayoutOrder = #Tab.Frame:GetChildren(),
        Parent = Tab.Frame
    })

    local SliderLabel = Library:Create("TextLabel", {
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1,
        Text = Config.Text or "Slider",
        TextColor3 = Colors.TextPrimary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        Font = Enum.Font.Gotham,
        ZIndex = 1002,
        Parent = SliderFrame
    })

    local SliderValue = Library:Create("TextLabel", {
        Size = UDim2.new(0, 60, 0, 20),
        Position = UDim2.new(1, -60, 0, 0),
        BackgroundTransparency = 1,
        Text = tostring(Slider.Value),
        TextColor3 = Colors.TextSecondary,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Right,
        Font = Enum.Font.Gotham,
        ZIndex = 1002,
        Parent = SliderFrame
    })

    local SliderTrack = Library:Create("Frame", {
        Size = UDim2.new(1, 0, 0, 15),
        Position = UDim2.new(0, 0, 1, -20),
        BackgroundColor3 = Colors.Primary,
        BorderSizePixel = 0,
        ZIndex = 1002,
        Parent = SliderFrame
    })

    local SliderTrackCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 7),
        Parent = SliderTrack
    })

    local SliderFill = Library:Create("Frame", {
        Size = UDim2.new((Slider.Value - Slider.Min) / (Slider.Max - Slider.Min), 0, 1, 0),
        BackgroundColor3 = Colors.PinkMedium,
        BorderSizePixel = 0,
        ZIndex = 1003,
        Parent = SliderTrack
    })

    local SliderFillCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 7),
        Parent = SliderFill
    })

    local SliderButton = Library:Create("TextButton", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = "",
        ZIndex = 1004,
        Parent = SliderTrack
    })

    function Slider:SetValue(Value)
        Value = math.clamp(Value, Slider.Min, Slider.Max)
        Slider.Value = Value
        SliderValue.Text = tostring(Value)
        SliderFill.Size = UDim2.new((Value - Slider.Min) / (Slider.Max - Slider.Min), 0, 1, 0)
        Library:SafeCallback(Slider.Callback, Value)
    end

    local function UpdateSliderFromMouse()
        local mousePos = UserInputService:GetMouseLocation()
        local trackPos = SliderTrack.AbsolutePosition
        local trackSize = SliderTrack.AbsoluteSize
        
        local relativeX = math.clamp((mousePos.X - trackPos.X) / trackSize.X, 0, 1)
        local value = math.floor(Slider.Min + (Slider.Max - Slider.Min) * relativeX)
        
        Slider:SetValue(value)
    end

    SliderButton.MouseButton1Down:Connect(function()
        UpdateSliderFromMouse()
        
        local connection
        connection = UserInputService.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then
                UpdateSliderFromMouse()
            end
        end)
        
        local function onInputEnded(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                connection:Disconnect()
                UserInputService.InputEnded:Disconnect(onInputEnded)
            end
        end
        
        UserInputService.InputEnded:Connect(onInputEnded)
    end)

    Options[Config.Flag or "Slider_" .. #Options + 1] = Slider
    return Slider
end

function Library:AddDropdown(Tab, Config)
    Config = Config or {}
    
    local Dropdown = {
        Value = Config.Default,
        Values = Config.Values or {},
        Type = "Dropdown",
        Callback = Config.Callback or function() end,
        Open = false
    }

    local DropdownFrame = Library:Create("Frame", {
        Size = UDim2.new(1, -10, 0, 30),
        BackgroundTransparency = 1,
        LayoutOrder = #Tab.Frame:GetChildren(),
        Parent = Tab.Frame
    })

    local DropdownButton = Library:Create("TextButton", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Colors.Primary,
        BorderSizePixel = 0,
        Text = Dropdown.Value or Config.Text or "Select...",
        TextColor3 = Colors.TextPrimary,
        TextSize = 14,
        Font = Enum.Font.Gotham,
        AutoButtonColor = false,
        ZIndex = 1002,
        Parent = DropdownFrame
    })

    local DropdownCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 8),
        Parent = DropdownButton
    })

    local DropdownList = Library:Create("ScrollingFrame", {
        Size = UDim2.new(1, 0, 0, 0),
        Position = UDim2.new(0, 0, 1, 5),
        BackgroundColor3 = Colors.Surface,
        BorderSizePixel = 0,
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Colors.PinkMedium,
        Visible = false,
        ZIndex = 1003,
        Parent = DropdownFrame
    })

    local DropdownListLayout = Library:Create("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = DropdownList
    })

    function Dropdown:Toggle()
        Dropdown.Open = not Dropdown.Open
        DropdownList.Visible = Dropdown.Open
        
        if Dropdown.Open then
            DropdownList.Size = UDim2.new(1, 0, 0, math.min(#Dropdown.Values * 30, 150))
            Library.OpenedFrames[DropdownList] = true
        else
            Library.OpenedFrames[DropdownList] = nil
        end
    end

    function Dropdown:SetValue(Value)
        Dropdown.Value = Value
        DropdownButton.Text = Value
        Library:SafeCallback(Dropdown.Callback, Value)
        Dropdown:Toggle()
    end

    function Dropdown:Refresh(NewValues)
        Dropdown.Values = NewValues or Dropdown.Values
        
        -- Clear existing options
        for _, child in ipairs(DropdownList:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        
        -- Add new options
        for _, value in ipairs(Dropdown.Values) do
            local OptionButton = Library:Create("TextButton", {
                Size = UDim2.new(1, 0, 0, 30),
                BackgroundColor3 = Colors.Primary,
                BorderSizePixel = 0,
                Text = tostring(value),
                TextColor3 = Colors.TextPrimary,
                TextSize = 14,
                Font = Enum.Font.Gotham,
                AutoButtonColor = false,
                ZIndex = 1004,
                Parent = DropdownList
            })

            Library:AddHoverEffect(OptionButton, Colors.HoverPrimary, Colors.Primary)

            OptionButton.MouseButton1Click:Connect(function()
                Dropdown:SetValue(value)
            end)
        end
    end

    DropdownButton.MouseButton1Click:Connect(function()
        Dropdown:Toggle()
    end)

    -- Close dropdown when clicking outside
    UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 and Dropdown.Open then
            if not Library:MouseIsOverOpenedFrame() then
                Dropdown:Toggle()
            end
        end
    end)

    -- Initialize options
    Dropdown:Refresh()

    Library:AddHoverEffect(DropdownButton, Colors.HoverPrimary, Colors.Primary)

    Options[Config.Flag or "Dropdown_" .. #Options + 1] = Dropdown
    return Dropdown
end

function Library:AddLabel(Tab, Config)
    Config = Config or {}
    
    local Label = {
        Type = "Label",
        Text = Config.Text or "Label"
    }

    local LabelFrame = Library:Create("Frame", {
        Size = UDim2.new(1, -10, 0, 25),
        BackgroundTransparency = 1,
        LayoutOrder = #Tab.Frame:GetChildren(),
        Parent = Tab.Frame
    })

    local LabelElement = Library:Create("TextLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = Label.Text,
        TextColor3 = Colors.TextPrimary,
        TextSize = 14,
        TextXAlignment = Config.Center and Enum.TextXAlignment.Center or Enum.TextXAlignment.Left,
        Font = Enum.Font.Gotham,
        ZIndex = 1002,
        Parent = LabelFrame
    })

    function Label:SetText(Text)
        Label.Text = Text
        LabelElement.Text = Text
    end

    Labels[Config.Flag or "Label_" .. #Labels + 1] = Label
    return Label
end

-- ========================================
-- HELPER FUNCTIONS
-- ========================================
function Library:AddHoverEffect(Element, HoverColor, NormalColor)
    Element.MouseEnter:Connect(function()
        TweenService:Create(Element, TweenInfo.new(0.2), {
            BackgroundColor3 = HoverColor
        }):Play()
    end)

    Element.MouseLeave:Connect(function()
        TweenService:Create(Element, TweenInfo.new(0.2), {
            BackgroundColor3 = NormalColor
        }):Play()
    end)
end

function Library:Notify(Title, Message, Duration)
    Duration = Duration or 5
    
    local NotifyFrame = Library:Create("Frame", {
        Size = UDim2.new(0, 300, 0, 80),
        Position = UDim2.new(1, -320, 0, 20),
        BackgroundColor3 = Colors.Surface,
        BorderSizePixel = 0,
        ZIndex = 2000,
        Parent = ScreenGui
    })

    local NotifyCorner = Library:Create("UICorner", {
        CornerRadius = UDim.new(0, 12),
        Parent = NotifyFrame
    })

    local NotifyStroke = Library:Create("UIStroke", {
        Color = Colors.PinkMedium,
        Thickness = 2,
        Parent = NotifyFrame
    })

    local TitleLabel = Library:Create("TextLabel", {
        Size = UDim2.new(1, -20, 0, 25),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1,
        Text = Title or "Notification",
        TextColor3 = Colors.TextPrimary,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        ZIndex = 2001,
        Parent = NotifyFrame
    })

    local MessageLabel = Library:Create("TextLabel", {
        Size = UDim2.new(1, -20, 1, -45),
        Position = UDim2.new(0, 10, 0, 35),
        BackgroundTransparency = 1,
        Text = Message or "",
        TextColor3 = Colors.TextSecondary,
        TextSize = 14,
        TextWrapped = true,
        Font = Enum.Font.Gotham,
        ZIndex = 2001,
        Parent = NotifyFrame
    })

    -- Animate in
    NotifyFrame.Position = UDim2.new(1, 300, 0, 20)
    TweenService:Create(NotifyFrame, TweenInfo.new(0.3), {
        Position = UDim2.new(1, -320, 0, 20)
    }):Play()

    -- Auto remove after duration
    task.delay(Duration, function()
        TweenService:Create(NotifyFrame, TweenInfo.new(0.3), {
            Position = UDim2.new(1, 300, 0, 20)
        }):Play()
        task.wait(0.3)
        NotifyFrame:Destroy()
    end)
end

-- ========================================
-- INITIALIZATION AND EXPORTS
-- ========================================
function Library:Unload()
    ParticleState.IsDestroyed = true
    for _, signal in ipairs(Library.Signals) do
        signal:Disconnect()
    end
    ScreenGui:Destroy()
end

-- Make library globally available
getgenv().NexusUI = Library

return Library
